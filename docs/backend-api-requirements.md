# λ°±μ—”λ“ API μ—°λ™ μ”κµ¬μ‚¬ν•­

## μ‘μ—… λ²”μ„
**λ°±μ—”λ“ κΈ°λ¥λ§ μ¶”κ°€ν•©λ‹λ‹¤. ν”„λ΅ νΈμ—”λ“λ” μμ •ν•μ§€ λ§μ„Έμ”.**

μ¶”κ°€ν•  κ²ƒ:
- Claude API (AI μ‘λ‹µ μƒμ„±)
- ElevenLabs API (STT + TTS)
- μ‹μ¤ν… ν”„λ΅¬ν”„νΈ μ μ©
- API Routes μƒμ„±
- ν™κ²½ λ³€μ νμΌ μƒμ„±

**μ¤‘μ”: κΈ°μ΅΄ ν”„λ΅ νΈμ—”λ“ μ»΄ν¬λ„νΈλ” κ±΄λ“λ¦¬μ§€ μ•μµλ‹λ‹¤. API μ—”λ“ν¬μΈνΈλ§ λ§λ“¤μ–΄μ£Όμ„Έμ”.**

---

## ν™κ²½ λ³€μ μ„¤μ •

### νμΌ κµ¬μ΅°
λ‹¤μ 3κ°μ ν™κ²½ λ³€μ νμΌμ„ μƒμ„±:

1. **`.env.local`** (λ΅μ»¬ κ°λ°μ©, gitignoreμ— μ¶”κ°€)
```bash
CLAUDE_API_KEY=sk-ant-api03-xxxxx
ELEVENLABS_API_KEY=sk_xxxxx
```

2. **`.env.production`** (ν”„λ΅λ•μ…μ©, λ°°ν¬ ν”λ«νΌμ—μ„ λ³„λ„ μ„¤μ •)
```bash
CLAUDE_API_KEY=sk-ant-api03-xxxx
ELEVENLABS_API_KEY=sk_xxxxx
```

3. **`.env.example`** (Gitμ— ν¬ν•¨, μμ‹μ©)
```bash
CLAUDE_API_KEY=your_claude_api_key_here
ELEVENLABS_API_KEY=your_elevenlabs_api_key_here
```

### .gitignore μ—…λ°μ΄νΈ
λ‹¤μ ν•­λ© μ¶”κ°€:
```
.env.local
.env.production
```

---

## μ‹μ¤ν… ν”„λ΅¬ν”„νΈ μ„¤μ •

### ν”„λ΅¬ν”„νΈ νμΌ μƒμ„±
`/app/config/system-prompt.ts` νμΌ μƒμ„±:

```typescript
export const SYSTEM_PROMPT = `λ‹Ήμ‹ μ€ μ„Έκ³„ κ°κµ­μ μ–Έμ–΄μ™€ λ¬Έν™”λ¥Ό κ°€λ¥΄μΉλ” μΉκ·Όν• μ„ μƒλ‹μ…λ‹λ‹¤. μ νλΈ μ½ν…μΈ  μ΄¬μμ„ μ„ν•΄ ν•™μµμμ™€ μμ„±μΌλ΅ λ€ν™”ν•λ©° μ–‘λ°©ν–¥ μ†ν†µμ„ μ§„ν–‰ν•©λ‹λ‹¤.

## μ—­ν•  μ„¤μ •
- μ΄¬μ μ‹μ‘ μ „ μ§€μ •λ°›μ€ κµ­κ°€μ μ›μ–΄λ―Ό μ—¬μ„± μ„ μƒλ‹μΌλ΅ μ—­ν•  μν–‰
- ν•΄λ‹Ή μ–Έμ–΄λ¥Ό μ›μ–΄λ―Ό μμ¤€μΌλ΅ κµ¬μ‚¬ν•λ©° λ¬Έν™”μ  λ§¥λ½κΉμ§€ μ΄ν•΄
- λ”°λ»ν•κ³  μΉκ·Όν• μ„±κ²©μΌλ΅ ν•™μµμλ¥Ό νΈν•κ² λ€ν•¨
- μ–΄λ–¤ μ§λ¬Έμ΄λ“  μ μ—°ν•κ² λ€μ²ν•λ©°, μμƒμΉ λ»ν• μ§λ¬Έλ„ μμ—°μ¤λ½κ² λ‹µλ³€

## μ΄¬μ μ‹μ‘ ν”„λ΅μ„Έμ¤

### 1λ‹¨κ³„: κµ­κ°€ μ„¤μ • (μ±„ν…)
ν•™μµμκ°€ μ±„ν…μΌλ΅ "μ¤λμ€ [κµ­κ°€λ…] ν•  κ±°μ•Ό" λλ” "[κµ­κ°€λ…]"λ§ μ…λ ¥ν•λ©΄, ν•΄λ‹Ή κµ­κ°€μ AI μ›μ–΄λ―Ό μ„ μƒλ‹μΌλ΅ μ„Έν…λ©λ‹λ‹¤.

μμ‹:
- "μ¤λμ€ ν”„λ‘μ¤ ν•  κ±°μ•Ό" β†’ ν”„λ‘μ¤ μ„ μƒλ‹μΌλ΅ μ„Έν…
- "μΌλ³Έ" β†’ μΌλ³Έ μ„ μƒλ‹μΌλ΅ μ„Έν…
- "μ¤νμΈμ–΄" β†’ μ¤νμΈ μ„ μƒλ‹μΌλ΅ μ„Έν…

### 2λ‹¨κ³„: μ„Έν… μ™„λ£ ν™•μΈ (μ±„ν…)
μ„Έν…μ΄ μ™„λ£λλ©΄ λ°λ“μ‹ μ±„ν…μΌλ΅ "μ„Έν… μ™„λ£λμ—μµλ‹λ‹¤."λΌκ³  λ‹µλ³€ν•©λ‹λ‹¤.
μ΄ λ©”μ‹μ§€λ¥Ό λ³΄κ³  ν•™μµμκ°€ μμ„± κΈ°λ¥μ„ ν™μ„±ν™”ν•©λ‹λ‹¤.

### 3λ‹¨κ³„: μ‹μ‘ λ©νΈ λ€κΈ° (μμ„±)
ν•™μµμκ°€ μμ„±μΌλ΅ "μ¤λμ μ›μ–΄λ―Ό μ„ μƒλ‹ λ¨μ‹κ² μµλ‹λ‹¤" λλ” μ μ‚¬ν• μ‹μ‘ λ©νΈλ¥Ό ν•λ©΄, κ·Έλ• μ‹μ‘ μΈνΈλ΅λ¥Ό λ§ν•©λ‹λ‹¤.

## μ‹μ‘ μΈνΈλ΅ (μμ„±μΌλ΅ λ§ν•κΈ°)
"[ν•΄λ‹Ή κµ­κ°€ μ–Έμ–΄λ΅ μΈμ‚¬], μ—¬λ¬λ¶„μ AI [ν•΄λ‹Ή κµ­κ°€μ—μ„ μμ£Ό μ“°λ” μ΄λ¦„]μμ”. μ €λ¥Ό μ„ μƒλ‹ νΉμ€ [μ΄λ¦„]μΌλ΅ λ¶λ¬μ£Όμ„Έμ”."

κµ­κ°€λ³„ μΈνΈλ΅ μμ‹:
- ν”„λ‘μ¤: "Bonjour! μ—¬λ¬λ¶„μ AI μ†ν”Όμμ”. μ €λ¥Ό μ„ μƒλ‹ νΉμ€ μ†ν”Όλ΅ λ¶λ¬μ£Όμ„Έμ”."
- μΌλ³Έ: "γ“γ‚“γ«γ΅γ―! μ—¬λ¬λ¶„μ AI μ‚¬μΏ λΌμμ”. μ €λ¥Ό μ„ μƒλ‹ νΉμ€ μ‚¬μΏ λΌλ΅ λ¶λ¬μ£Όμ„Έμ”."
- μ¤νμΈ: "Β΅Hola! μ—¬λ¬λ¶„μ AI μΉ΄λ¥΄λ©μ΄μ—μ”. μ €λ¥Ό μ„ μƒλ‹ νΉμ€ μΉ΄λ¥΄λ©μΌλ΅ λ¶λ¬μ£Όμ„Έμ”."
- λ…μΌ: "Guten Tag! μ—¬λ¬λ¶„μ AI ν•λ‚μμ”. μ €λ¥Ό μ„ μƒλ‹ νΉμ€ ν•λ‚λ΅ λ¶λ¬μ£Όμ„Έμ”."
- μ΄νƒλ¦¬μ•„: "Ciao! μ—¬λ¬λ¶„μ AI μ§€μΈλ¦¬μ•„μμ”. μ €λ¥Ό μ„ μƒλ‹ νΉμ€ μ§€μΈλ¦¬μ•„λ΅ λ¶λ ¤μ£Όμ„Έμ”."
- μ¤‘κµ­: "δ½ ε¥½! μ—¬λ¬λ¶„μ AI μƒ¤μ¤λ©”μ΄μμ”. μ €λ¥Ό μ„ μƒλ‹ νΉμ€ μƒ¤μ¤λ©”μ΄λ΅ λ¶λ¬μ£Όμ„Έμ”."
- λ² νΈλ‚¨: "Xin chΓ o! μ—¬λ¬λ¶„μ AI λ¦°μ΄μ—μ”. μ €λ¥Ό μ„ μƒλ‹ νΉμ€ λ¦°μΌλ΅ λ¶λ¬μ£Όμ„Έμ”."
- νƒκµ­: "ΰΈΰΈ§ΰΈ±ΰΈΰΈ”ΰΈµΰΈ„ΰΉΰΈ°! μ—¬λ¬λ¶„μ AI λ‚λ¦¬μ‚¬μμ”. μ €λ¥Ό μ„ μƒλ‹ νΉμ€ λ‚λ¦¬μ‚¬λ΅ λ¶λ¬μ£Όμ„Έμ”."

## λ§ν¬ λ° μ†ν†µ λ°©μ‹
- κΈ°λ³Έμ€ μ΅΄λ“λ§ μ‚¬μ© (μ: "μ΄ ν‘ν„μ€μ”~", "ν•λ² λ”°λΌν•΄ λ³΄μ‹¤λμ”?")
- ν•™μµμκ°€ μ‹¤μν•κ±°λ‚ μ–΄λ¦¬λ²„λ¦¬ν•  λ•λ§ μΉκ·Όν• λ°λ§λ΅ μ „ν™ (μ: "μ•„λ‹μ•Ό, μ΄λ ‡κ² λ°μν•λ” κ±°μ•Ό!", "κ΄μ°®μ•„, λ‹¤μ‹ ν•΄λ³΄μ!")
- ν• λ²μ— μµλ€ 5μ¤„ μ΄λ‚΄λ΅ κ°„κ²°ν•κ² λ‹µλ³€
- λ”±λ”±ν• κ°•μμ²΄κ°€ μ•„λ‹ λ€ν™”μ²΄ μ‚¬μ©
- ν•™μµμμ λ°μ‘μ„ κΈ°λ‹¤λ¦¬κ³  μ§λ¬Έμ„ μ λ„ν•λ” μ–‘λ°©ν–¥ μ†ν†µ
- μ΄λ¨μ§€λ‚ κ°νƒ„μ‚¬λ¥Ό μ μ ν ν™μ©ν•΄ μƒλ™κ° μκ² ν‘ν„

## μ½ν…μΈ  μ¤νƒ€μΌ
1. **μ–Έμ–΄ ν•™μµ**: μ‹¤μƒν™ ν‘ν„, λ°μ ν, ν”ν• μ‹¤μ κµμ •
2. **λ¬Έν™” νƒλ°©**: ν„μ§€ λ¬Έν™”, μμ‹, κ΄€μµ, μ—ν‹°μΌ“ μ†κ°
3. **μ  μ§€ μ„Έλ€ μ–΄ν**: μ ν–‰μ–΄, μ‹ μ΅°μ–΄, λ° λ¬Έν™” μ„¤λ…
4. **κ°κ·Έ μ”μ†**: μ–Έμ–΄ μ λ¨Έ, λ¬Έν™”μ  μ°¨μ΄μ—μ„ μ¤λ” μ¬λ―Έ ν¬μΈνΈ
5. **μΉκ·Όν•¨**: "μ„ μƒλ‹"μ΄λΌκΈ°λ³΄λ‹¨ "μ–Έλ‹ κ°™μ€ κ°€μ΄λ“" λλ‚

## μ μ—°ν• λ€μ² μ›μΉ™
- μμƒμΉ λ»ν• μ§λ¬Έλ„ λ‹Ήν™©ν•μ§€ μ•κ³  μμ—°μ¤λ½κ² λ‹µλ³€
- λ¨λ¥΄λ” λ‚΄μ©μ€ μ†”μ§ν•κ² μΈμ •ν•λ, ν•¨κ» μ•μ•„λ³΄μλ” νƒλ„
- μ½ν…μΈ  νλ¦„μ—μ„ λ²—μ–΄λ‚ μ§λ¬Έλ„ μ¬λ―Έμκ² λ°›μ•„λ“¤μ΄κ³  λ‹¤μ‹ μμ—°μ¤λ½κ² μ£Όμ λ΅ μ λ„
- ν•™μµμμ κ΄€μ‹¬μ‚¬λ‚ κ°μΈμ  κ²½ν—μ„ μ—°κ²°ν•΄μ„ μ„¤λ…

## λ‹µλ³€ μ›μΉ™
- μ „λ¬Έ μ©μ–΄λ³΄λ‹¤λ” μ‰½κ³  μΊμ£Όμ–Όν• μ„¤λ… μ°μ„ 
- ν•μ§€λ§ μ •λ³΄λ” μ •ν™•ν•κ³  μ‹ λΆ°ν•  μ μκ²
- ν•™μµμκ°€ μ΄ν•΄ν–λ”μ§€ ν™•μΈν•λ” μ§λ¬Έ λμ§€κΈ°
- ν‹€λ¦° λ°μμ΄λ‚ ν‘ν„μ€ λ¶€λ“λ½κ² λ°λ§λ΅ κµμ •ν•λ©° κ²©λ ¤
- μΉ­μ°¬κ³Ό κ²©λ ¤λ¥Ό μμ£Ό ν™μ©`;
```

---

## API Routes κµ¬μ΅°

### 1. Claude API μ—”λ“ν¬μΈνΈ
**νμΌ**: `/app/api/chat/route.ts`

**κΈ°λ¥**:
- μ‚¬μ©μ λ©”μ‹μ§€λ¥Ό λ°›μ•„μ„ Claude APIλ΅ μ „μ†΅
- μ‹μ¤ν… ν”„λ΅¬ν”„νΈ μλ™ ν¬ν•¨
- λ€ν™” νμ¤ν† λ¦¬ κ΄€λ¦¬
- μ—λ¬ ν•Έλ“¤λ§

**μ”μ²­ ν•μ‹**:
```typescript
POST /api/chat
Body: {
  message: string,
  conversationHistory?: Array<{role: 'user' | 'assistant', content: string}>
}
```

**μ‘λ‹µ ν•μ‹**:
```typescript
{
  response: string,
  error?: string
}
```

**κµ¬ν„ μ”κµ¬μ‚¬ν•­**:
- Anthropic SDK μ‚¬μ© (`@anthropic-ai/sdk`)
- λ¨λΈ: `claude-sonnet-4-20250514`
- max_tokens: 1000
- μ‹μ¤ν… ν”„λ΅¬ν”„νΈλ” `/app/config/system-prompt.ts`μ—μ„ import
- API ν‚¤λ” ν™κ²½ λ³€μμ—μ„ κ°€μ Έμ¤κΈ°
- μ—λ¬ λ°μƒ μ‹ λ…ν™•ν• μ—λ¬ λ©”μ‹μ§€ λ°ν™
- **Prompt Caching μ‚¬μ©** (ν† ν° λΉ„μ© 90% μ κ°)

**Prompt Caching κµ¬ν„**:
```typescript
const response = await anthropic.messages.create({
  model: "claude-sonnet-4-20250514",
  max_tokens: 1000,
  system: [
    {
      type: "text",
      text: SYSTEM_PROMPT, // κΈ΄ μ‹μ¤ν… ν”„λ΅¬ν”„νΈ
      cache_control: { type: "ephemeral" } // μΊμ‹± ν™μ„±ν™”!
    }
  ],
  messages: conversationHistory
});
```

**Prompt Caching μ¥μ **:
- μ²« API νΈμ¶: μ •μƒ λΉ„μ© (μ…λ ¥ $3/million tokens)
- μ΄ν›„ 5λ¶„ λ‚΄ νΈμ¶: μΊμ‹λ ν”„λ΅¬ν”„νΈλ” 90% ν• μΈ ($0.30/million tokens)
- κΈ΄ μ‹μ¤ν… ν”„λ΅¬ν”„νΈλ¥Ό λ§¤λ² λ³΄λ‚΄λ„ λΉ„μ© μ μ•½
- 5λ¶„λ§λ‹¤ μΊμ‹ κ°±μ‹ λ¨

### 2. ElevenLabs STT μ—”λ“ν¬μΈνΈ
**νμΌ**: `/app/api/stt/route.ts`

**κΈ°λ¥**:
- μ¤λ””μ¤ νμΌμ„ λ°›μ•„μ„ ν…μ¤νΈλ΅ λ³€ν™
- ElevenLabs Speech-to-Text API μ‚¬μ©

**μ”μ²­ ν•μ‹**:
```typescript
POST /api/stt
Body: FormData {
  audio: File (audio blob)
}
```

**μ‘λ‹µ ν•μ‹**:
```typescript
{
  text: string,
  error?: string
}
```

**κµ¬ν„ μ”κµ¬μ‚¬ν•­**:
- ElevenLabs SDK μ‚¬μ© λλ” fetchλ΅ μ§μ ‘ νΈμ¶
- λ¨λΈ: `scribe_v1` λλ” `scribe_v2_realtime`
- μ–Έμ–΄: ν•κµ­μ–΄ (`ko-KR`) μλ™ κ°μ§€
- μ¤λ””μ¤ ν•μ‹: webm, mp3, wav λ“± μ§€μ›
- API ν‚¤λ” ν™κ²½ λ³€μμ—μ„ κ°€μ Έμ¤κΈ°

### 3. ElevenLabs TTS μ—”λ“ν¬μΈνΈ
**νμΌ**: `/app/api/tts/route.ts`

**κΈ°λ¥**:
- ν…μ¤νΈλ¥Ό λ°›μ•„μ„ μμ„±μΌλ΅ λ³€ν™
- ElevenLabs Text-to-Speech API μ‚¬μ©

**μ”μ²­ ν•μ‹**:
```typescript
POST /api/tts
Body: {
  text: string,
  voiceId?: string  // μ„ νƒ μ‚¬ν•­, κΈ°λ³Έ λ©μ†λ¦¬ μ‚¬μ©
}
```

**μ‘λ‹µ ν•μ‹**:
```typescript
audio/mpeg (MP3 νμΌ μ¤νΈλ¦Ό)
```

**κµ¬ν„ μ”κµ¬μ‚¬ν•­**:
- ElevenLabs SDK μ‚¬μ©
- κΈ°λ³Έ λ©μ†λ¦¬: μ—¬μ„± ν•κµ­μ–΄ λ©μ†λ¦¬ (λλ” μ§€μ •λ voice ID)
- λ¨λΈ: `eleven_multilingual_v2` μ¶”μ²
- μ¤νΈλ¦¬λ° μ‘λ‹µ μ§€μ›
- API ν‚¤λ” ν™κ²½ λ³€μμ—μ„ κ°€μ Έμ¤κΈ°

---

## λ‹¤μ λ‹¨κ³„ (λ³„λ„ μ‘μ—…)

λ‚μ¤‘μ— ν”„λ΅ νΈμ—”λ“λ¥Ό μμ •ν•  λ•:
- Mock API νΈμ¶μ„ μ‹¤μ  μ—”λ“ν¬μΈνΈλ΅ κµμ²΄
- μμ„± μ…λ ¥ ν”λ΅μ° μ—°κ²°
- λ€ν™” νμ¤ν† λ¦¬ κ΄€λ¦¬
- μ—λ¬ μ²λ¦¬

**μ§€κΈμ€ API μ—”λ“ν¬μΈνΈλ§ λ§λ“¤λ©΄ λ©λ‹λ‹¤.**

---

## ν•„μ”ν• ν¨ν‚¤μ§€ μ„¤μΉ

```bash
npm install @anthropic-ai/sdk
npm install elevenlabs
```

λλ”

```bash
npm install @anthropic-ai/sdk
# ElevenLabsλ” fetchλ΅ μ§μ ‘ νΈμ¶ν•΄λ„ λ¨
```

---

## λ³΄μ• κ³ λ ¤μ‚¬ν•­

1. **API ν‚¤ λ³΄νΈ**
   - μ λ€ ν΄λΌμ΄μ–ΈνΈ μ½”λ“μ— λ…Έμ¶ μ• λ¨
   - λ¨λ“  API νΈμ¶μ€ Next.js API Routesλ¥Ό ν†µν•΄μ„λ§
   - ν™κ²½ λ³€μλ” μ„λ²„ μ‚¬μ΄λ“μ—μ„λ§ μ ‘κ·Ό

2. **CORS μ„¤μ •**
   - API Routesλ” κ°™μ€ λ„λ©”μΈμ΄λ―€λ΅ CORS μ΄μ μ—†μ
   - ν•„μ”μ‹ μ¶”κ°€ μ„¤μ •

3. **Rate Limiting** (μ„ νƒ μ‚¬ν•­)
   - κ³Όλ„ν• API νΈμ¶ λ°©μ§€
   - μ¶”ν›„ ν•„μ”μ‹ κµ¬ν„

---

## μ—λ¬ ν•Έλ“¤λ§

λ¨λ“  API μ—”λ“ν¬μΈνΈλ” λ‹¤μ ν•μ‹μΌλ΅ μ—λ¬ μ²λ¦¬:

```typescript
try {
  // API νΈμ¶
} catch (error) {
  console.error('Error:', error);
  return Response.json(
    { error: 'μ”μ²­ μ²λ¦¬ μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤.' },
    { status: 500 }
  );
}
```

ν”„λ΅ νΈμ—”λ“μ—μ„λ” μ—λ¬ λ°μƒ μ‹ μ‚¬μ©μμ—κ² μΉμ ν• λ©”μ‹μ§€ ν‘μ‹.

---

## ν…μ¤νΈ μ²΄ν¬λ¦¬μ¤νΈ

μ™„λ£ ν›„ λ‹¤μ ν•­λ©λ“¤μ„ ν…μ¤νΈ:
- [ ] ν™κ²½ λ³€μκ°€ μ λ€λ΅ λ΅λ“λλ”μ§€
- [ ] Claude API νΈμ¶μ΄ μ‘λ™ν•λ”μ§€ (μ‹μ¤ν… ν”„λ΅¬ν”„νΈ ν¬ν•¨)
- [ ] ElevenLabs STTκ°€ ν•κµ­μ–΄ μμ„±μ„ μ •ν™•ν μΈμ‹ν•λ”μ§€
- [ ] ElevenLabs TTSκ°€ μμ—°μ¤λ¬μ΄ λ©μ†λ¦¬λ΅ μ¬μƒλλ”μ§€
- [ ] λ€ν™” νμ¤ν† λ¦¬κ°€ μ μ§€λλ”μ§€
- [ ] μ—λ¬ λ°μƒ μ‹ μ μ ν• λ©”μ‹μ§€κ°€ ν‘μ‹λλ”μ§€
- [ ] μ› μ• λ‹λ©”μ΄μ…μ΄ μμ„±μ— λ§μ¶° μ‘λ™ν•λ”μ§€

---

## μ°μ„ μμ„

1. β… ν™κ²½ λ³€μ νμΌ μƒμ„±
2. β… μ‹μ¤ν… ν”„λ΅¬ν”„νΈ νμΌ μƒμ„±
3. π”„ Claude API μ—”λ“ν¬μΈνΈ κµ¬ν„
4. π”„ ElevenLabs STT μ—”λ“ν¬μΈνΈ κµ¬ν„
5. π”„ ElevenLabs TTS μ—”λ“ν¬μΈνΈ κµ¬ν„
6. π”„ ν”„λ΅ νΈμ—”λ“ μ—°λ™
7. π”„ ν…μ¤νΈ λ° λ””λ²„κΉ…

---

## μ°Έκ³ μ‚¬ν•­

- Claude API λ¬Έμ„: https://docs.anthropic.com/claude/reference/messages_post
- ElevenLabs API λ¬Έμ„: https://elevenlabs.io/docs
- Next.js API Routes: https://nextjs.org/docs/app/building-your-application/routing/route-handlers
