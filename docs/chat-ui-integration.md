# 채팅 API 연동 및 UI/UX 구현 요구사항

## 작업 내용

### 1. Chat API 주석 해제
- 현재 주석 처리된 `/api/chat` 관련 코드 모두 활성화
- Claude API 연동 정상 작동하도록 수정

### 2. 채팅 전송 및 응답
- 사용자 음성 → STT → 텍스트를 `/api/chat`으로 전송
- Claude AI 응답 받기
- 응답을 화면에 표시 + TTS로 음성 출력

### 3. 화면 레이아웃 (응답 출력 시)
```
┌─────────────────────────┐
│  사용자: [질문 내용]      │  ← 상단 10%
│                         │
│  AI: [응답 내용]         │  ← 중앙 60-70%
│  여러분의 AI 소피예요.    │
│  이 표현은요...          │
│  (응답 텍스트)           │
│                         │
├─────────────────────────┤
│         ⬤              │  ← 하단 20-30%
│     (마이크 아이콘)      │     (작은 검은 원 + 애니메이션)
└─────────────────────────┘
```

---

## 상태별 UI 동작

### 상태 1: 대기 (Idle)
- 큰 검은 원: 화면 중앙
- 텍스트: "탭하여 시작"
- 원 크기: 기본 크기

### 상태 2: 듣는 중 (Listening)
- 큰 검은 원: 화면 중앙 유지
- 텍스트: "듣는 중..." → 인식된 텍스트로 실시간 변경
- 원 크기: 음성 볼륨에 맞춰 커졌다 작아짐

### 상태 3: 생각하는 중 (Processing)
- 텍스트: "생각하는 중..."
- 원: 부드러운 펄스 애니메이션

### 상태 4: 응답 중 (Speaking)
**화면 전환 (0.5초 애니메이션)**:
1. 검은 원이 하단으로 이동하면서 크기 축소 (기본 크기의 40%)
2. 동시에 채팅 영역이 fade-in으로 나타남

**레이아웃**:
- 상단 10%: 사용자 질문 (배경: 연한 회색, 오른쪽 정렬)
- 중앙 65%: AI 응답 (타이핑 효과로 한 글자씩 표시)
- 하단 25%: 작은 검은 원 (중앙 배치, 마이크 아이콘 표시)

**원 애니메이션**:
- TTS 음성 재생 중: 음성 크기에 맞춰 작게 커졌다 작아짐
- 음파 효과 (선택 사항)

### 상태 5: 응답 완료 후 복귀
**자동 복귀 (기본)**:
1. 음성 재생 완료
2. 2초 대기
3. 채팅 내용 fade-out (0.5초)
4. 원이 중앙으로 이동하며 원래 크기로 복귀 (0.5초)
5. "탭하여 시작" 표시 → 상태 1로

**수동 시작 (추가)**:
- 응답 중에도 하단의 작은 원 클릭 가능
- 클릭 시: 음성 중단 + 즉시 상태 1로 복귀 + 새 음성 인식 시작

---

## 채팅 UI 디자인

### 사용자 메시지
```
┌──────────────────┐
│    안녕하세요?    │  
└──────────────────┘
```
- 배경: 연한 회색 (#F0F0F0)
- 오른쪽 정렬
- 둥근 모서리
- 패딩: 12px 16px
- 폰트: 16px

### AI 응답
```
┌──────────────────┐
│ Bonjour!         │
│ 여러분의 AI       │
│ 소피예요. 저를    │
│ 선생님 혹은...    │
└──────────────────┘
```
- 배경: 없음 (투명) 또는 아주 연한 배경
- 왼쪽 정렬
- 타이핑 효과 (한 글자씩, 30ms 간격)
- 폰트: 18px
- 줄간격: 1.6

### 하단 작은 원
- 크기: 기본 원의 40%
- 위치: 화면 하단 중앙
- 마이크 아이콘: 흰색
- 음성 재생 중: 볼륨에 따라 애니메이션
- 클릭 시: 음성 중단 + 새 음성 인식 시작

---

## 애니메이션 타이밍

### 원 이동 (중앙 → 하단)
- duration: 0.5s
- easing: ease-in-out
- 크기 변화와 동시 진행

### 채팅 표시
- 사용자 메시지: fade-in 0.3s
- AI 응답: 타이핑 효과 (30ms/글자)

### 복귀 (하단 → 중앙)
- 2초 대기 후
- 채팅 fade-out: 0.5s
- 원 이동 + 크기 복귀: 0.5s

---

## API 연동 플로우

```
사용자 음성 입력
    ↓
STT API (/api/stt)
    ↓
텍스트 → Chat API (/api/chat)
    ↓
Claude 응답
    ↓
┌─────────────────┬─────────────────┐
│  화면에 표시     │  TTS API        │
│  (타이핑 효과)   │  (/api/tts)     │
└─────────────────┴─────────────────┘
         ↓                 ↓
    동시 진행          음성 재생
                    (원 애니메이션)
         ↓
    2초 대기
         ↓
    화면 복귀
```

---

## 상태 관리

```typescript
type AppState = 'idle' | 'listening' | 'processing' | 'speaking';

interface ChatMessage {
  role: 'user' | 'assistant';
  content: string;
}

// State
const [appState, setAppState] = useState<AppState>('idle');
const [currentMessage, setCurrentMessage] = useState<ChatMessage | null>(null);
const [isAutoReturning, setIsAutoReturning] = useState(false);
```

---

## 인터랙션 세부사항

### 대기 중 원 클릭
→ 음성 인식 시작

### 듣는 중 원 클릭
→ 음성 인식 중단 + 처리 시작

### 응답 중 작은 원 클릭
→ 음성 중단 + 즉시 새 음성 인식 시작

### 응답 중 채팅 영역 클릭
→ 아무 동작 없음 (또는 스크롤 가능)

---

## 에러 처리

- API 실패 시: "오류가 발생했습니다" 표시 + 2초 후 상태 1로 복귀
- 음성 인식 실패: "다시 시도해주세요" + 상태 1로 복귀
- 네트워크 오류: "연결을 확인해주세요" 표시

---

## 추가 개선사항

### 선택 사항 1: 음성 재생 컨트롤
- 하단 원 옆에 작은 일시정지 버튼
- 재생 속도 조절 (0.8x, 1x, 1.2x)

### 선택 사항 2: 대화 히스토리
- 이전 대화 내용 저장
- 왼쪽 상단에 작은 히스토리 버튼
- 클릭하면 이전 대화 목록 표시

### 선택 사항 3: 시각적 피드백 강화
- 음성 재생 중 원 주변에 음파 링 효과
- 타이핑 효과에 커서 깜빡임
- 상태 전환 시 부드러운 색상 변화

---

## 구현 우선순위

1. ✅ Chat API 주석 해제 및 연동
2. ✅ 응답 화면 레이아웃 구현
3. ✅ 원 위치/크기 전환 애니메이션
4. ✅ 타이핑 효과
5. ✅ TTS 재생 및 원 애니메이션 동기화
6. ✅ 자동 복귀 (2초 대기)
7. ✅ 수동 시작 (작은 원 클릭)
8. ⏳ 선택 사항들 (필요시)
